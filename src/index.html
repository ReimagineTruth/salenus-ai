<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Salenus AI">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="msapplication-TileColor" content="#667eea">
    <meta name="msapplication-config" content="/browserconfig.xml">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="/icons/icon-192x192.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/icons/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/icon-180x180.png">
    <link rel="apple-touch-icon" sizes="167x167" href="/icons/icon-167x167.png">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/icon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/icon-16x16.png">
    <link rel="shortcut icon" href="/icons/icon-192x192.png">
    
    <!-- Preconnect to external domains -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://sdk.minepi.com">
    
    <!-- Cache Control -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <!-- STEP 2: Enhanced CORS headers for Pi Browser subdomain compatibility -->
    <meta http-equiv="Access-Control-Allow-Origin" content="*" />
    <meta http-equiv="Access-Control-Allow-Methods" content="GET, POST, PUT, DELETE, OPTIONS" />
    <meta http-equiv="Access-Control-Allow-Headers" content="Content-Type, Authorization, X-Requested-With" />
    <meta http-equiv="Access-Control-Allow-Credentials" content="true" />
    
    <!-- Remove X-Frame-Options to allow iframe embedding on Pi subdomains -->
    <meta http-equiv="X-Frame-Options" content="SAMEORIGIN" />
    
    <!-- Allow embedding on Pi Network subdomains -->
    <script>
      // Allow iframe embedding on Pi Network subdomains
      if (window.location.hostname.includes('pinet.com') || 
          window.location.hostname.includes('minepi.com')) {
        // Remove any X-Frame-Options headers for Pi subdomains
        try {
          // This will be handled by the server, but we can also handle it client-side
          console.log('üåê Pi subdomain detected - allowing iframe embedding');
        } catch (e) {
          console.log('‚ÑπÔ∏è Client-side iframe handling applied');
        }
      }
    </script>
    
    <!-- Primary Meta Tags -->
    <title>Salenus AI - Pi-Powered AI Productivity Coach</title>
    <meta name="title" content="Salenus AI - Pi-Powered AI Productivity Coach">
    <meta name="description" content="Transform your life with Salenus AI, the first Pi-powered AI coach designed exclusively for the Pi Network ecosystem. Track habits, boost productivity, and achieve your goals with intelligent AI coaching.">
    <meta name="keywords" content="AI coach, productivity, habit tracking, Pi Network, personal development, goal setting, time management">
    <meta name="author" content="Salenus AI Team">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://salenus.xyz/">
    <meta property="og:title" content="Salenus AI - Pi-Powered AI Productivity Coach">
    <meta property="og:description" content="Transform your life with Salenus AI, the first Pi-powered AI coach designed exclusively for the Pi Network ecosystem.">
    <meta property="og:image" content="https://salenus.xyz/og-image.png">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://salenus.xyz/">
    <meta property="twitter:title" content="Salenus AI - Pi-Powered AI Productivity Coach">
    <meta property="twitter:description" content="Transform your life with Salenus AI, the first Pi-powered AI coach designed exclusively for the Pi Network ecosystem.">
    <meta property="twitter:image" content="https://salenus.xyz/og-image.png">
    
    <!-- STEP 1: Enhanced Pi Browser subdomain detection and fixes -->
    <script>
      // Detect if running in Pi Browser subdomain
      const isPiSubdomain = window.location.hostname.includes('pinet.com') || 
                           window.location.hostname.includes('minepi.com');
      
      // Detect if running in iframe
      const isInIframe = window.self !== window.top;
      
      // Log environment for debugging (STEP 1: Check Console Errors)
      console.log('üîç STEP 1: Environment Detection:', {
        hostname: window.location.hostname,
        isPiSubdomain: isPiSubdomain,
        isInIframe: isInIframe,
        userAgent: navigator.userAgent,
        protocol: window.location.protocol,
        fullUrl: window.location.href
      });
      
      // Apply subdomain-specific fixes
      if (isPiSubdomain) {
        console.log('‚úÖ Pi subdomain detected, applying subdomain fixes...');
        
        // Force HTTPS for subdomains (STEP 6: Check HTTPS/SSL)
        if (window.location.protocol !== 'https:' && window.location.hostname !== 'localhost') {
          console.log('üîÑ Forcing HTTPS for subdomain...');
          window.location.replace(window.location.href.replace('http:', 'https:'));
        }
        
        // Handle X-Frame-Options issue for Pi subdomains
        if (window.location.hostname.includes('salenusai7785.pinet.com')) {
          console.log('üéØ Specific fix for salenusai7785.pinet.com');
          
          // Try to break out of iframe if possible
          try {
            if (window.top !== window.self) {
              console.log('üîÑ Attempting to break out of iframe...');
              // Only break out if not in Pi Browser
              if (!navigator.userAgent.includes('Pi')) {
                window.top.location = window.self.location;
              }
            }
          } catch (e) {
            console.log('‚ÑπÔ∏è Cannot break out of iframe (expected in Pi Browser)');
          }
        }
        
        // Add subdomain-specific styles
        const style = document.createElement('style');
        style.textContent = `
          /* Pi subdomain specific fixes */
          .pi-subdomain {
            /* Ensure proper rendering in Pi Browser subdomain */
            transform: translateZ(0);
            -webkit-transform: translateZ(0);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            min-height: 100dvh;
          }
          
          .pi-subdomain body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            min-height: 100dvh;
            overflow-x: hidden;
          }
          
          .pi-subdomain #root {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            min-height: 100dvh;
            display: flex;
            flex-direction: column;
          }
        `;
        document.head.appendChild(style);
        
        // Add subdomain class to body
        document.body.classList.add('pi-subdomain');
      }
      
      // Iframe detection and fixes (STEP 4: Avoid Iframe Embeds)
      if (isInIframe) {
        console.log('‚ö†Ô∏è Running in iframe, applying iframe-specific fixes...');
        document.body.classList.add('pi-iframe');
        
        // Try to break out of iframe if possible
        try {
          if (window.top !== window.self) {
            console.log('üîÑ Attempting to break out of iframe...');
            // Only break out if not in Pi Browser
            if (!navigator.userAgent.includes('Pi')) {
              window.top.location = window.self.location;
            }
          }
        } catch (e) {
          console.log('‚ÑπÔ∏è Cannot break out of iframe (expected in Pi Browser)');
        }
      }
    </script>

    <!-- Prevent Pi SDK loading errors from breaking the app -->
    <script>
      // Prevent Pi SDK loading errors from breaking the app
      window.addEventListener('error', function(e) {
        if (e.message.includes('Pi') || e.message.includes('pi-sdk') || e.message.includes('CORS')) {
          console.warn('‚ö†Ô∏è Pi SDK/CORS error caught:', e.message);
          e.preventDefault();
        }
      });
    </script>
    
    <!-- STEP 3: Enhanced Pi Network SDK with subdomain compatibility -->
    <script src="https://sdk.minepi.com/pi-sdk.js" onerror="console.warn('‚ùå Pi SDK failed to load')"></script>
    <script>
      // STEP 3: Fix Pi SDK Integration
      window.onload = () => {
        console.log('üîÑ STEP 3: Initializing Pi SDK...');
        
        try {
          if (typeof Pi !== 'undefined') {
            console.log('‚úÖ Pi SDK loaded successfully');
            
            // Enhanced initialization for subdomains
            const initOptions = {
              version: "2.0", 
              sandbox: true
            };
            
            // Add subdomain-specific options
            if (window.location.hostname.includes('pinet.com')) {
              console.log('üåê Initializing Pi SDK for subdomain...');
              // Additional options for subdomain compatibility
              initOptions.sandbox = true; // Ensure sandbox mode for subdomains
            }
            
            Pi.init(initOptions);
            console.log('‚úÖ Pi SDK initialized successfully');
            
            // Test Pi SDK functionality
            if (Pi.authenticate) {
              console.log('‚úÖ Pi.authenticate is available');
            }
            if (Pi.currentUser) {
              console.log('‚úÖ Pi.currentUser is available');
            }
            
            // Test authentication
            Pi.authenticate(['payments'], onIncompletePaymentFound).then(function(auth) {
              console.log('‚úÖ Pi authentication successful:', auth);
            }).catch(function(error) {
              console.warn('‚ö†Ô∏è Pi authentication failed:', error);
            });
            
          } else {
            console.warn('‚ùå Pi SDK not available, continuing without Pi features');
          }
        } catch (error) {
          console.warn('‚ùå Pi SDK initialization failed:', error);
          
          // Fallback for subdomain issues
          if (window.location.hostname.includes('pinet.com')) {
            console.log('üîÑ Attempting fallback Pi SDK initialization for subdomain...');
            setTimeout(() => {
              try {
                if (typeof Pi !== 'undefined') {
                  Pi.init({ version: "2.0", sandbox: true });
                  console.log('‚úÖ Fallback Pi SDK initialization successful');
                }
              } catch (fallbackError) {
                console.warn('‚ùå Fallback Pi SDK initialization also failed:', fallbackError);
              }
            }, 1000);
          }
        }
      };
      
      // Pi authentication callback
      function onIncompletePaymentFound(payment) {
        console.log('üí∞ Incomplete payment found:', payment);
        return Promise.resolve();
      }
    </script>
    
    <!-- PWA Service Worker Registration -->
    <script>
      // Register service worker for PWA functionality
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', function() {
          navigator.serviceWorker.register('/sw.js')
            .then(function(registration) {
              console.log('PWA Service Worker registered successfully:', registration.scope);
            })
            .catch(function(error) {
              console.log('PWA Service Worker registration failed:', error);
            });
        });
      }
      
      // Handle PWA install prompt
      let deferredPrompt;
      window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        console.log('PWA install prompt ready');
      });
    </script>
    
    <!-- Enhanced Mobile Detection -->
    <script>
      // Enhanced mobile detection and fixes
      const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
      const isPiBrowser = navigator.userAgent.toLowerCase().includes('pi') || 
                         navigator.userAgent.toLowerCase().includes('minepi');
      
      if (isMobile || isPiBrowser) {
        // Add mobile-specific classes
        document.documentElement.classList.add('mobile-device');
        if (isPiBrowser) {
          document.documentElement.classList.add('pi-browser');
        }
        
        // Set viewport height for mobile
        const setVH = () => {
          const vh = window.innerHeight * 0.01;
          document.documentElement.style.setProperty('--vh', `${vh}px`);
        };
        
        setVH();
        window.addEventListener('resize', setVH);
        window.addEventListener('orientationchange', setVH);
      }
    </script>
</head>
<body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
</body>
</html> 